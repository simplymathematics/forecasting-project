---
title: "624 Project 2"
output:
  html_document:
    df_print: paged
---
# Final Project

## Dependencies

Our code requires the following dependencies

```{r}
library(readxl)
library(ggplot2)
library(tidyr)
library(randomForest)
library(corrplot)
library(forecast)
library(imputeTS)
```

### Upload the data. All the columns have numeric values but Brand Code. 

```{r}
training <- read_excel("StudentData.xlsx")
test     <- read_excel("StudentEvaluation.xlsx")
```

### Data Cleaning

### Remove highly correlated variables

```{r}
library(AppliedPredictiveModeling)
library(caret)
summary(descCor[upper.tri(descCor)])
highCorr <- sum(abs(descCor[upper.tri(descCor)]) > .75)
highlyCorDesc <- findCorrelation(descCor, cutoff = .75)
training <- training[,-highlyCorDesc]
test <- test[,-highlyCorDesc]
```

### Look at predictors

```{r}
library(reshape2)
meltedTrain <- melt(train, id.vars = "Brand Code")
head(meltedTrain)

library(lattice)
densityplot(~value|variable, 
            data = meltedTrain, 
            ## Adjust each axis so that the measurement scale is
            ## different for each panel
            scales = list(x = list(relation = "free"), 
                          y = list(relation = "free")),
            ## 'adjust' smooths the curve out
            adjust = 1.25, 
            ## change the symbol on the rug for each data point
            pch = "|",
            xlab = "Variable")
```

### In the above density plots, Bowl Setpoint, Pressure Setpoint, Carb FLow, Usage cont, Fill Pressure, Carb Pressure1, Hyd Pressure1, Hyd Pressure2, Hyd Pressure4, Carb Volume have possible second or more modes, PSC, PSC Fill, PSC CO2 show slight skewness, and PH, Filler Speed, Temperature, MFR, Oxygen Filler seem having outliers. Also, more than half of the variables have heavy tails.


### Missing value checking

```{r}
## Response variable missing value 
table(is.na(training$PH))
## remove rows with missing response variable
training <- training[!is.na(training$PH), ]
## missing data by Brand Code
table(training$'Brand Code', complete.cases(training), useNA = 'always')
## fill missing Brand Code value with U
training$`Brand Code`[is.na(training$`Brand Code`)] <- 'U'
## near zero value predictors
nzv <- nearZeroVar(training, saveMetrics= TRUE)
nzv[nzv$nzv,]

```

### Pre-process data, remove near zero predictors, filling in missing values with knn method, tranform predictors using YeoJohnson method, center and scale the data as well.

```{r}
preProcValues <- preProcess(training[, -20], method = c("YeoJohnson", "nzv", "knnImpute"))
trainTransformed <- predict(preProcValues, training)
```

### SVM model

```{r}
set.seed(66)
fitControl <- trainControl(## 10-fold CV
                           method = "repeatedcv",
                           number = 10,
                           ## repeated ten times
                           repeats = 10)
svmFit <- train(PH ~ ., data = trainTransformed, 
                 method = "svmRadial", 
                 trControl = fitControl, 
                 tuneLength = 8,
                 metric = "RMSE")
svmFit                 

```



